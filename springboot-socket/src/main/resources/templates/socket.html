<!DOCTYPE html>
<html lang="cn">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>消息推送</title>
</head>
<body>

</body>
<script src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdn.staticfile.org/socket.io/2.3.0/socket.io.js"></script>
<h1>Socket.io Test</h1>
<div><p id="status">Waiting for input</p></div>
<div><p id="message">hello world!</p></div>
<button id="connect" onClick='connect()'>
    Connect
</button>
<button id="disconnect" onClick='disconnect()'>Disconnect</button>
<button id="send" onClick='send()'>Send Message</button>

<script type="text/javascript">

    /**
     * 前端js的 socket.emit("事件名","参数数据")方法，是触发后端自定义消息事件的时候使用的,
     * 前端js的 socket.on("事件名",匿名函数(服务器向客户端发送的数据))为监听服务器端的事件
     **/
    const socket = io.connect("http://127.0.0.1:9090?mac=2");
    const firstConnect = true;

    function connect() {
        if (firstConnect) {
            //socket.on('reconnect', function(){ status_update("Reconnected to Server"); });
            //socket.on('reconnecting', function( nextRetry ){ status_update("Reconnecting in "
            //+ nextRetry + " seconds"); });
            //socket.on('reconnect_failed', function(){ message("Reconnect Failed"); });
            //firstconnect = false;
        } else {
            socket.socket.reconnect();
        }
    }

    //监听服务器连接事件
    socket.on('connect', function () {
        status_update("Connected to Server");
    });
    //监听服务器关闭服务事件
    socket.on('disconnect', function () {
        status_update("Disconnected from Server");
    });
    //监听服务器端发送消息事件
    socket.on('messageEvent', function (data) {
        message(data)
        console.log("服务器发送的消息是：" + data);
    });

    //断开连接
    function disconnect() {
        socket.disconnect();
    }

    function message(data) {
        document.getElementById('message').innerHTML = "Server says: " + data;
    }

    function status_update(txt) {
        document.getElementById('status').innerHTML = txt;
    }

    function esc(msg) {
        return msg.replace(/</g, '<').replace(/>/g, '>');
    }

    //点击发送消息触发
    function send() {
        console.log("点击了发送消息，开始向服务器发送消息")
        const msg = "我很好的,是的．";
        socket.emit('messageEvent', {msgContent: msg});
    }
</script>
</html>